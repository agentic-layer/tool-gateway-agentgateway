# This sample demonstrates a complete ToolGateway deployment with multiple MCP tool servers
# spread across different namespaces, with path-based routing.
# It can be applied to a test cluster using:
#   kubectl apply -f toolgateway_v1alpha1_toolgateway_with_toolserver.yaml

# Create the tool-gateway namespace for the gateway and class
---
apiVersion: v1
kind: Namespace
metadata:
  name: tool-gateway

# Create namespaces for the tool servers
---
apiVersion: v1
kind: Namespace
metadata:
  name: namespace-a

---
apiVersion: v1
kind: Namespace
metadata:
  name: namespace-b

# ToolGatewayClass - defines the controller implementation
---
apiVersion: runtime.agentic-layer.ai/v1alpha1
kind: ToolGatewayClass
metadata:
  name: agentgateway
  namespace: tool-gateway
  annotations:
    toolgatewayclass.kubernetes.io/is-default-class: "true"
spec:
  controller: runtime.agentic-layer.ai/tool-gateway-agentgateway-controller

# ConfigMap referenced by the ToolGateway envFrom
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: test-gateway-config
  namespace: tool-gateway
data:
  SOME_CONFIG_VAR: "from-configmap"

# ToolGateway - creates a Gateway for routing to ToolServers
---
apiVersion: runtime.agentic-layer.ai/v1alpha1
kind: ToolGateway
metadata:
  name: test-tool-gateway
  namespace: tool-gateway
spec:
  toolGatewayClassName: agentgateway
  env:
    - name: TEST_GATEWAY_ENV_VAR
      value: "hello-from-toolgateway"
  envFrom:
    - configMapRef:
        name: test-gateway-config

# ToolServer 1: server-a in namespace-a with custom tool "get_weather"
---
apiVersion: runtime.agentic-layer.ai/v1alpha1
kind: ToolServer
metadata:
  name: server-a
  namespace: namespace-a
spec:
  protocol: mcp
  transportType: http
  image: ghcr.io/agentic-layer/echo-mcp-server:0.2.0
  port: 8000
  replicas: 1
  env:
    - name: ECHO_SERVER_NAME
      value: "Server A"
    - name: ECHO_TOOL_NAME
      value: "get_weather"
    - name: ECHO_TOOL_RESPONSE
      value: "Sunny, 72Â°F"
  toolGatewayRef:
    name: test-tool-gateway
    namespace: tool-gateway

# ToolServer 2: server-b in namespace-a with custom tool "get_status"
---
apiVersion: runtime.agentic-layer.ai/v1alpha1
kind: ToolServer
metadata:
  name: server-b
  namespace: namespace-a
spec:
  protocol: mcp
  transportType: http
  image: ghcr.io/agentic-layer/echo-mcp-server:0.2.0
  port: 8000
  replicas: 1
  env:
    - name: ECHO_SERVER_NAME
      value: "Server B"
    - name: ECHO_TOOL_NAME
      value: "get_status"
    - name: ECHO_TOOL_RESPONSE
      value: "All systems operational"
  toolGatewayRef:
    name: test-tool-gateway
    namespace: tool-gateway

# ToolServer 3: server-c in namespace-b with custom tool "get_info"
---
apiVersion: runtime.agentic-layer.ai/v1alpha1
kind: ToolServer
metadata:
  name: server-c
  namespace: namespace-b
spec:
  protocol: mcp
  transportType: http
  image: ghcr.io/agentic-layer/echo-mcp-server:0.2.0
  port: 8000
  replicas: 1
  env:
    - name: ECHO_SERVER_NAME
      value: "Server C"
    - name: ECHO_TOOL_NAME
      value: "get_info"
    - name: ECHO_TOOL_RESPONSE
      value: "Information available"
  toolGatewayRef:
    name: test-tool-gateway
    namespace: tool-gateway
