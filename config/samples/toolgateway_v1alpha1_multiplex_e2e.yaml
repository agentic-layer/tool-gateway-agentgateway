# E2E test sample for multiplex MCP routes
# Creates multiple MCP servers in different namespaces to test multiplex functionality

# Namespaces
---
apiVersion: v1
kind: Namespace
metadata:
  name: tool-gateway

---
apiVersion: v1
kind: Namespace
metadata:
  name: namespace-a

---
apiVersion: v1
kind: Namespace
metadata:
  name: namespace-b

# ToolGatewayClass
---
apiVersion: runtime.agentic-layer.ai/v1alpha1
kind: ToolGatewayClass
metadata:
  name: agentgateway
  namespace: tool-gateway
  annotations:
    toolgatewayclass.kubernetes.io/is-default-class: "true"
spec:
  controller: runtime.agentic-layer.ai/tool-gateway-agentgateway-controller

# ToolGateway
---
apiVersion: runtime.agentic-layer.ai/v1alpha1
kind: ToolGateway
metadata:
  name: test-tool-gateway
  namespace: tool-gateway
spec:
  toolGatewayClassName: agentgateway

# ToolServer 1: server-a in namespace-a with custom tool "get_weather"
---
apiVersion: runtime.agentic-layer.ai/v1alpha1
kind: ToolServer
metadata:
  name: server-a
  namespace: namespace-a
spec:
  protocol: mcp
  transportType: http
  image: ghcr.io/agentic-layer/echo-mcp-server:0.2.0
  port: 8000
  replicas: 1
  env:
    - name: ECHO_SERVER_NAME
      value: "Server A"
    - name: ECHO_TOOL_NAME
      value: "get_weather"
    - name: ECHO_TOOL_RESPONSE
      value: "Sunny, 72Â°F"
  toolGatewayRef:
    name: test-tool-gateway
    namespace: tool-gateway

# ToolServer 2: server-b in namespace-a with custom tool "get_status"
---
apiVersion: runtime.agentic-layer.ai/v1alpha1
kind: ToolServer
metadata:
  name: server-b
  namespace: namespace-a
spec:
  protocol: mcp
  transportType: http
  image: ghcr.io/agentic-layer/echo-mcp-server:0.2.0
  port: 8000
  replicas: 1
  env:
    - name: ECHO_SERVER_NAME
      value: "Server B"
    - name: ECHO_TOOL_NAME
      value: "get_status"
    - name: ECHO_TOOL_RESPONSE
      value: "All systems operational"
  toolGatewayRef:
    name: test-tool-gateway
    namespace: tool-gateway

# ToolServer 3: server-c in namespace-b with custom tool "get_info"
---
apiVersion: runtime.agentic-layer.ai/v1alpha1
kind: ToolServer
metadata:
  name: server-c
  namespace: namespace-b
spec:
  protocol: mcp
  transportType: http
  image: ghcr.io/agentic-layer/echo-mcp-server:0.2.0
  port: 8000
  replicas: 1
  env:
    - name: ECHO_SERVER_NAME
      value: "Server C"
    - name: ECHO_TOOL_NAME
      value: "get_info"
    - name: ECHO_TOOL_RESPONSE
      value: "Information available"
  toolGatewayRef:
    name: test-tool-gateway
    namespace: tool-gateway
